<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <title>–ë—É—Ä–≥–µ—Ä-–±–∏—Ç–≤–∞ üçî</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .highlight {
      animation: flash 0.5s ease;
    }
    @keyframes flash {
      0% { background-color: #fef3c7; }
      100% { background-color: transparent; }
    }
  </style>
</head>
<body class="bg-gray-100 font-sans text-gray-800">
  <h1 class="text-4xl font-bold text-center mt-8">üçî –õ–∏–¥–µ—Ä–±–æ—Ä–¥ –ø–æ–µ–¥–∞–Ω–∏—è –±—É—Ä–≥–µ—Ä–æ–≤</h1>

  <div class="overflow-x-auto mt-8">
    <table class="mx-auto min-w-[600px] border-collapse shadow-lg bg-white">
      <thead class="bg-yellow-300 text-gray-800 text-xl">
        <tr>
          <th class="px-6 py-3">–§–æ—Ç–æ</th>
          <th class="px-6 py-3">–ò–º—è</th>
          <th class="px-6 py-3">–ë—É—Ä–≥–µ—Ä—ã</th>
        </tr>
      </thead>
      <tbody id="leaderboard"></tbody>
    </table>
  </div>

  <script>
    let oldData = {};

    async function update() {
      const res = await fetch("/leaders");
      const data = await res.json();

      // —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –ø–æ count (—É–±—ã–≤–∞–Ω–∏–µ)
      data.sort((a,b) => b.count - a.count);

      const tbody = document.querySelector("#leaderboard");
      tbody.innerHTML = data.map(p => {
        const oldCount = oldData[p.id] || 0;
        const highlight = (p.count !== oldCount) ? "highlight" : "";
        oldData[p.id] = p.count;
        return `
          <tr class="text-center ${highlight}" id="row-${p.id}">
            <td class="px-4 py-2">
              <img src="${p.photo}" class="w-16 h-16 rounded-full mx-auto">
            </td>
            <td class="px-6 py-2 text-xl font-medium">${p.name}</td>
            <td class="px-6 py-2 text-2xl font-bold">${p.count}</td>
          </tr>
        `;
      }).join("");
    }

    // –æ–±–Ω–æ–≤–ª—è–µ–º –∫–∞–∂–¥—ã–µ 1.5 —Å–µ–∫—É–Ω–¥—ã
    setInterval(update, 1500);
    update();
  </script>
</body>
</html>
